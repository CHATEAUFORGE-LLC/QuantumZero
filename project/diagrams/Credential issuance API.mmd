sequenceDiagram
  autonumber
  actor Client as Wallet / Client App
  participant API as Issuer REST API
  participant AUTH as Auth Service (OAuth2 / JWT)
  participant POL as Authorization Policy Engine
  participant VC as Credential Issuer Service
  participant KMS as Signing Key Manager
  participant HSM as HSM / Secure Key Store
  participant DB as Issuer Credential Store
  participant LOG as Audit / Metrics

  Client->>API: POST /credentials/issue\n(Authorization: Bearer JWT)
  API->>AUTH: Validate token (signature, expiry, scope)
  AUTH-->>API: Token valid (subject, claims)

  API->>POL: Evaluate authorization\n(client role, issuer rights, schema)
  POL-->>API: Authorized

  API->>VC: Build Verifiable Credential\n(W3C-compliant JSON)
  VC->>KMS: Request signing operation
  KMS->>HSM: Sign VC payload
  Note over HSM: Issuer private key never leaves HSM
  HSM-->>KMS: Signature
  KMS-->>VC: Signed proof

  VC->>DB: Store issued VC (hash + metadata)
  DB-->>VC: Stored

  API->>LOG: Record issuance event\n(latency, issuer, subject)
  API-->>Client: 201 Created + VC (<500ms)

