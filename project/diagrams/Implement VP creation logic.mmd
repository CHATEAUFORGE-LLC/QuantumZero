sequenceDiagram
  autonumber
  actor User
  participant W as QuantumZero Wallet (Holder)
  participant DB as Wallet Storage (Encrypted)
  participant DID as DID Resolver (Local Cache)
  participant H as Secure Enclave / Android Keystore
  participant Q as Outbox / Sync Queue (Optional)

  User->>W: Select credentials to present
  W->>DB: Load Verifiable Credential(s)
  DB-->>W: VC(s) (locally stored)

  W->>DID: Resolve Holder DID (local cache)
  DID-->>W: DID Document + verificationMethod

  W->>W: Build Verifiable Presentation (VP)
  Note over W: VP includes\n@context, type, holder, verifiableCredential

  W->>H: Sign VP payload\n(JSON-LD / JWT per W3C)
  Note over H: Private key never leaves hardware
  H-->>W: Cryptographic signature

  W->>W: Attach proof\n(type, created, verificationMethod,\nproofPurpose, challenge, domain)

  W->>DB: Store VP (encrypted at rest)
  DB-->>W: Stored

  opt Offline usage
    W->>Q: Queue VP usage event (optional)
    Note over Q: Deferred sync when online
  end

  W-->>User: VP ready for presentation (<1s)

