---
title: Sequence Diagram - Mobile Vp Creation (Planned)
config:
  theme: base
---
%% QuantumZero UML palette note: actors/external=#fff7e6/#b45309, system/component=#e0f2fe/#075985, datastore=#ecfccb/#4d7c0f, notes=#fff9c4/#d97706. Aligns diagrams to Deliverable 1 UML/DFD theme.
sequenceDiagram
  autonumber
  actor User
  participant W as QuantumZero Wallet (Holder)
  participant DB as Wallet Storage (planned)
  participant DID as DID Resolver (Local Cache) (optional)
  participant PlatformKeys as Platform Keystore/Keychain
  participant Q as Outbox / Sync Queue (Optional)

  User->>W: Select credentials to present
  W->>DB: Load Verifiable Credential(s)
  DB-->>W: VC(s) (locally stored)

  W->>DID: Resolve Holder DID (local cache)
  DID-->>W: DID Document + verificationMethod

  W->>W: Build Verifiable Presentation (VP)
  Note over W: VP includes holder, selected credential references,\nchallenge/domain binding

  W->>PlatformKeys: Sign VP payload\n(challenge + domain binding)
  Note over PlatformKeys: Key material managed by platform\nnon-exportable by policy
  PlatformKeys-->>W: Cryptographic signature

  W->>W: Attach proof\n(type, created, verificationMethod,\nproofPurpose, challenge, domain)

  W->>DB: Store VP (encrypted at rest)
  DB-->>W: Stored

  opt Offline usage
    W->>Q: Queue VP usage event (optional)
    Note over Q: Deferred sync when online
  end

  W-->>User: VP ready for presentation
