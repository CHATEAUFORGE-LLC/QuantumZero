---
title: Component Diagram - Server Architecture Overview
config:
  theme: base
---
%% QuantumZero UML palette note: actors/external=#fff7e6/#b45309, system/component=#e0f2fe/#075985, datastore=#ecfccb/#4d7c0f, notes=#fff9c4/#d97706. Aligns diagrams to Deliverable 1 UML/DFD theme.
flowchart TB
    %% QuantumZero UML palette (standardized)
    classDef actor fill:#fff7e6,stroke:#b45309,stroke-width:2px
    classDef component fill:#e0f2fe,stroke:#075985,stroke-width:2px
    classDef service fill:#e8f5e9,stroke:#166534,stroke-width:2px
    classDef datastore fill:#ecfccb,stroke:#4d7c0f,stroke-width:2px

    %% Service Layer
    subgraph Services["Service Layer"]
        direction TB
        WebFrontend["<<component>> Web Frontend (Actix Files) :3000"]:::component
        Gateway["<<component>> API Gateway<br/>TLS termination (TLS 1.3)"]:::component
        AdminAPI["<<component>> Admin API (Actix-Web) :8080"]:::service
        IssuanceAPI["<<component>> Issuance API"]:::service
        VerificationAPI["<<component>> Verification API"]:::service
        RevocationAPI["<<component>> Revocation API"]:::service
        Logs[("<<database>> Admin/Audit Logs<br/>Structured JSON")]:::datastore
        TrustReg[("<<database>> Trust Registry<br/>schema reference: QuantumZero-server/ledgerDB")]:::datastore
    end
    
    %% Shared Libraries
    subgraph SharedLibs["Shared Libraries"]
        direction LR
        Common["<<component>> qz-common"]:::component
        IndyClient["<<component>> qz-indy-client"]:::component
    end
    
    %% Data Layer
    subgraph DataLayer["Data Layer"]
        direction LR
        PostgreSQL["<<database>> PostgreSQL 16"]:::datastore
    end

    %% External ledger access (via ledger browser HTTP)
    subgraph Ledger["External Ledger (Docker network: indy)"]
        direction TB
        LedgerBrowser["<<component>> Ledger Browser (VON) :8000"]:::component
        IndyPool["<<component>> Indy Node Pool (node1..node4)"]:::component
    end
    
    %% External Systems
    subgraph External["External Systems"]
        direction TB
        Browser["Admin Browser (SPA client)"]:::actor
    end
    
    %% Dependencies
    AdminAPI -->|uses| Common
    AdminAPI -->|uses| IndyClient
    
    AdminAPI -->|stores| PostgreSQL

    IndyClient -->|HTTP GET| LedgerBrowser
    LedgerBrowser --> IndyPool
    
    Browser -->|HTTP| WebFrontend
    Browser -->|fetch /api/v1/*| AdminAPI

    %% Routing and cross-cutting concerns
    Browser -->|HTTPS| Gateway
    Gateway --> AdminAPI
    Gateway --> IssuanceAPI
    Gateway --> VerificationAPI
    Gateway --> RevocationAPI

    AdminAPI -.-> Logs
    IssuanceAPI -.-> Logs
    VerificationAPI -.-> Logs
    RevocationAPI -.-> Logs

    AdminAPI -.-> TrustReg
    IssuanceAPI -.-> TrustReg
    VerificationAPI -.-> TrustReg
    RevocationAPI -.-> TrustReg

    %% Ledger usage by additional APIs (see component-server-core-services.mmd)
    IssuanceAPI -.-> LedgerBrowser
    VerificationAPI -.-> LedgerBrowser
    RevocationAPI -.-> LedgerBrowser
    
