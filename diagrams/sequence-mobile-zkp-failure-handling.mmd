---
title: Sequence Diagram - Mobile Zkp Failure Handling (Planned)
config:
  theme: base
---
%% QuantumZero UML palette note: actors/external=#fff7e6/#b45309, system/component=#e0f2fe/#075985, datastore=#ecfccb/#4d7c0f, notes=#fff9c4/#d97706. Aligns diagrams to Deliverable 1 UML/DFD theme.
sequenceDiagram
    autonumber
    participant User
    participant UI as Wallet UI
    participant ZK_Engine as ZKP Service (planned)
    participant Err_Handler as Error Manager

    Note over User, Err_Handler: Handling ZKP Generation Failures

    User->>UI: Request predicate proof
    activate UI
    
    UI->>ZK_Engine: generateProof(inputs)
    activate ZK_Engine
    
    %% Failure example
    Note right of ZK_Engine: Error event raised
    ZK_Engine-->>Err_Handler: Throw exception
    deactivate ZK_Engine
    activate Err_Handler

    %% Analysis & Recovery
    Err_Handler->>Err_Handler: analyzeError(error)
    
    alt Recoverable Error (e.g., Timeout)
        Err_Handler-->>UI: Suggest Retry (Auto)
        UI->>ZK_Engine: retryGenerateProof()
        activate ZK_Engine
        ZK_Engine-->>UI: Success (on 2nd try)
        deactivate ZK_Engine
    else Fatal Error (e.g., Invalid Claim)
        Err_Handler-->>UI: Return "Claim Invalid"
        UI->>User: Display: "Verification Failed: Criteria not met"
        deactivate UI
    else Hardware Limitation
        Err_Handler-->>UI: Return "Device Incompatible"
        UI->>User: Display: "Use Fallback QR Code"
    end
    deactivate Err_Handler
