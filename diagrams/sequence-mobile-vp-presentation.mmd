---
title: Sequence Diagram - Mobile Vp Presentation
config:
  theme: base
---
sequenceDiagram
  autonumber
  actor U as User
  participant V as Verifier (Relying Party)
  participant VA as Verifier Presentation Request Service
  participant W as QuantumZero Wallet (Holder)
  participant K as Secure Enclave / Android Keystore
  participant R as DID Resolver
  participant RS as Credential Status Service (StatusList2021/bitstring)
  participant TR as Trust Registry (optional)

  V->>VA: Create presentation request (required claims, policies)
  VA-->>V: Request ready (challenge, domain/audience, constraints)

  V-->>W: Send request via QR/deep link (Presentation Definition)
  W-->>U: Show what will be shared + options (selective disclosure)

  opt Verify verifier trust (optional)
    W->>TR: Check verifier registration / policy
    TR-->>W: Verifier trusted / allowed
  end

  W->>W: Select matching VC(s)
  alt Selective disclosure / ZKP supported
    W->>W: Derive proof (reveal only required attributes)
  else Full VC presentation
    W->>W: Include required VC(s) as-is
  end

  W->>K: Sign Verifiable Presentation (VP) (challenge + domain binding)
  K-->>W: Signature/Proof attached to VP

  W-->>V: Send VP (VP JWT / JSON-LD VP)
  V->>R: Resolve issuer DID + fetch DID Document
  R-->>V: Issuer public keys / verification methods
  V->>R: Resolve holder DID (optional, if needed)
  R-->>V: Holder public keys (for VP signature)

  V->>V: Verify VP signature + challenge/domain + time validity
  V->>V: Verify VC signatures (issuer keys)
  V->>RS: Check credential status (revocation/suspension)
  RS-->>V: status=valid (or revoked)

  alt Valid + policy satisfied
    V-->>W: Presentation accepted (access granted)
    W-->>U: Success
  else Invalid / revoked / policy fail
    V-->>W: Presentation rejected (reason code)
    W-->>U: Failed + guidance
  end
