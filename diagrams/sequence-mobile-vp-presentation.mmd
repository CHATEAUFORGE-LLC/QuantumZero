---
title: Sequence Diagram - Mobile Prove a Fact (VP via QR)
config:
  theme: base
---
%% QuantumZero UML palette note: actors/external=#fff7e6/#b45309, system/component=#e0f2fe/#075985, datastore=#ecfccb/#4d7c0f, notes=#fff9c4/#d97706. Aligns diagrams to Deliverable 1 UML/DFD theme.
sequenceDiagram
  autonumber
  actor Verifier as Verifier / Relying Party
  actor User as Holder
  participant ScanUI as QrScanScreen
  participant ScanSvc as QrScanningService
  participant Cred as CredentialNotifier (credentialProvider)
  participant SD as SelectiveDisclosureService
  participant Crypto as CryptoService
  participant QrGen as QrGenerationService
  participant PresentUI as QrPresentationScreen

  Verifier-->>User: Displays proof request as QR
  User->>ScanUI: Scan verification request
  ScanUI->>ScanSvc: scanQr()
  ScanSvc-->>ScanUI: QrScanResult (qrData)
  ScanUI->>ScanSvc: validateQr(qrData)
  ScanSvc-->>ScanUI: valid/invalid
  ScanUI->>ScanSvc: parseQrData(qrData)
  ScanSvc-->>ScanUI: request (Map)

  ScanUI-->>User: Review request + select claims
  ScanUI->>Cred: loadCredentials()
  Cred-->>ScanUI: CredentialState (available credentials)

  ScanUI->>SD: createSelectiveDisclosure(credentialId, selectedClaims)
  SD-->>ScanUI: SelectiveDisclosureResult

  ScanUI->>Crypto: sign(data, keyId)
  Crypto-->>ScanUI: Signature

  ScanUI->>QrGen: generateSecureQr(data, nonce, expiryMinutes)
  QrGen-->>ScanUI: qrData

  ScanUI->>PresentUI: Navigate with qrData
  PresentUI-->>Verifier: Display VP QR for verifier to scan
