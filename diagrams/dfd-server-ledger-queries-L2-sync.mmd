---
title: DFD Level 2 - Full Ledger Sync (Process 4.0 Detailed)
config:
  theme: base
---
%% DFD (Gane-Sarson) notation aligned to sample.
%% Level 2: Detailed decomposition of Process 4.0 (Full Ledger Sync).
flowchart TB
    classDef external fill:#fff2cc,stroke:#111111,stroke-width:1.5px
    classDef process fill:#fff2cc,stroke:#111111,stroke-width:1.5px
    classDef datastore fill:#fff2cc,stroke:#111111,stroke-width:1.5px

    Admin["Admin User"]:::external
    Ledger["Indy Ledger<br>(VON Network)"]:::external

    P41(["4.1<br>Scan NYM<br>Transactions"]):::process
    P42(["4.2<br>Parse & Validate<br>Issuers"]):::process
    P43(["4.3<br>Scan SCHEMA<br>Transactions"]):::process
    P44(["4.4<br>Parse & Validate<br>Schemas"]):::process
    P45(["4.5<br>Scan CRED_DEF<br>Transactions"]):::process
    P46(["4.6<br>Parse & Validate<br>Cred Defs"]):::process
    P47(["4.7<br>Generate<br>Sync Report"]):::process

    D1[["D1<br>issuers"]]:::datastore
    D2[["D2<br>schemas"]]:::datastore
    D3[["D3<br>credential_definitions"]]:::datastore

    Admin -->|"POST /sync/ledger<br>(start_txn, end_txn)"| P41

    P41 -->|"GET_TXN (NYM)"| Ledger
    Ledger -->|"NYM txn data"| P41
    P41 -->|"raw NYM records"| P42

    P42 -->|"issuer records"| D1
    D1 -->|"existing issuers"| P42
    P42 -->|"issuer count"| P47

    P41 -->|"trigger schema scan"| P43
    P43 -->|"GET_TXN (SCHEMA)"| Ledger
    Ledger -->|"SCHEMA txn data"| P43
    P43 -->|"raw schema records"| P44

    P44 -->|"schema records"| D2
    D2 -->|"existing schemas"| P44
    P44 -->|"schema count"| P47

    P43 -->|"trigger cred def scan"| P45
    P45 -->|"GET_TXN (CRED_DEF)"| Ledger
    Ledger -->|"CRED_DEF txn data"| P45
    P45 -->|"raw cred def records"| P46

    P46 -->|"cred def records"| D3
    D3 -->|"existing cred defs"| P46
    P46 -->|"cred def count"| P47

    P47 -->|"sync summary<br>(counts, status, duration)"| Admin
