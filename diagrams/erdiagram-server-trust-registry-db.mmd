---
title: ER Diagram - Gateway Staging Database Schema (PostgreSQL)
config:
  theme: base
---
%% QuantumZero UML palette note: actors/external=#fff7e6/#b45309, system/component=#e0f2fe/#075985, datastore=#ecfccb/#4d7c0f, notes=#fff9c4/#d97706. Aligns diagrams to Deliverable 1 UML/DFD theme.
erDiagram
  ISSUERS ||--o{ SCHEMAS : issues
  ISSUERS ||--o{ CREDENTIAL_DEFINITIONS : defines
  SCHEMAS ||--o{ CREDENTIAL_DEFINITIONS : based_on
  CREDENTIAL_DEFINITIONS ||--o{ REVOCATION_REGISTRIES : revocation

  CREDENTIAL_TEMPLATE ||--o{ TEMPLATE_FIELD : includes
  TRUST_POLICY ||--o{ TRUST_POLICY_RULE : has
  TRUST_POLICY ||--o{ TRUST_POLICY_SCOPE : scopes
  CREDENTIAL_TEMPLATE ||--o{ TRUST_POLICY_SCOPE : templates
  TRUST_POLICY ||--o{ OFFLINE_CACHE_PACKAGE : packages
  OFFLINE_CACHE_PACKAGE ||--o{ OFFLINE_CACHE_ITEM : items

  ISSUERS {
    uuid id PK
    text did UK
    text verkey
    text alias
    text role
    text status
    text ledger_status
    timestamptz created_at
    timestamptz updated_at
  }

  SCHEMAS {
    uuid id PK
    text schema_id UK
    text name
    text version
    text_array attributes
    text issuer_did
    text ledger_status
    timestamptz created_at
  }

  CREDENTIAL_DEFINITIONS {
    uuid id PK
    text cred_def_id UK
    text schema_id
    text tag
    text issuer_did
    boolean support_revocation
    text ledger_status
    timestamptz created_at
  }

  REVOCATION_REGISTRIES {
    uuid id PK
    text rev_reg_id UK
    text cred_def_id
    text issuer_did
    bigint max_creds
    text status
    text ledger_status
    timestamptz created_at
    timestamptz updated_at
  }

  CREDENTIAL_TEMPLATE {
    uuid template_id PK
    text template_name UK
    text description
    text category
    text disclosure_policy
    boolean supports_offline
    timestamptz created_at
    timestamptz updated_at
  }

  TEMPLATE_FIELD {
    uuid field_id PK
    uuid template_id FK
    text field_name
    text display_label
    text data_type
    boolean required
    boolean reveal_by_default
    int display_order
  }

  TRUST_POLICY {
    uuid policy_id PK
    text policy_name
    text policy_version
    text status
    timestamptz effective_from
    timestamptz effective_to
    timestamptz created_at
  }

  TRUST_POLICY_RULE {
    uuid rule_id PK
    uuid policy_id FK
    text rule_type
    text subject_type
    text subject_ref
    jsonb constraint_json
    timestamptz created_at
  }

  TRUST_POLICY_SCOPE {
    uuid scope_id PK
    uuid policy_id FK
    uuid template_id FK
    text issuer_did_ref
    text schema_id_ref
    text cred_def_id_ref
    text rev_reg_id_ref
    timestamptz created_at
  }

  OFFLINE_CACHE_PACKAGE {
    uuid cache_id PK
    uuid policy_id FK
    text package_version
    text checksum
    text signature
    timestamptz generated_at
    timestamptz expires_at
  }

  OFFLINE_CACHE_ITEM {
    uuid item_id PK
    uuid cache_id FK
    text item_type
    text item_ref
    jsonb payload_json
  }
