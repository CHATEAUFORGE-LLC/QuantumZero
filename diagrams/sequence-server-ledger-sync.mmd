---
title: Sequence Diagram - Server Ledger Sync
config:
  theme: base
---
%% QuantumZero UML palette note: actors/external=#fff7e6/#b45309, system/component=#e0f2fe/#075985, datastore=#ecfccb/#4d7c0f, notes=#fff9c4/#d97706. Aligns diagrams to Deliverable 1 UML/DFD theme.
%% Implements: QuantumZero-server/services/admin-api/src/main.rs (startup<br>periodic task) and handlers.rs (perform_ledger_sync)
sequenceDiagram
  autonumber
  participant Timer as Startup/Interval Task
  participant API as Admin API (perform_ledger_sync)
  participant Indy as IndyClient (qz-indy-client)
  participant Ledger as Ledger Browser (VON)
  participant DB as PostgreSQL

  Timer->>API: perform_ledger_sync()
  activate API
  API->>Indy: scan_ledger()
  activate Indy
  Indy->>Ledger: GET /ledger/domain
  activate Ledger
  Ledger-->>Indy: domain ledger results
  deactivate Ledger
  Indy-->>API: LedgerScan (nyms, schemas, cred_defs)
  deactivate Indy

  API->>DB: Upsert issuers (nyms)
  activate DB
  DB-->>API: ok
  deactivate DB

  API->>DB: Upsert schemas (schemas)
  activate DB
  DB-->>API: ok
  deactivate DB

  API->>DB: Upsert credential_definitions (cred_defs)
  activate DB
  DB-->>API: ok
  deactivate DB

  API-->>Timer: sync summary
  deactivate API
