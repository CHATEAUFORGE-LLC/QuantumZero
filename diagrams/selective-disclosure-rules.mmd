sequenceDiagram
  autonumber
  actor Verifier
  actor User
  participant UI as Wallet UI
  participant W as QuantumZero Wallet
  participant DB as VC Store (Encrypted)
  participant SD as Selective Disclosure Engine
  participant CRYPTO as Crypto / ZKP / Proof Builder
  participant HSM as Secure Enclave / Keystore

  Verifier->>UI: Request proof\n(requested attributes + challenge)
  UI-->>User: Display requested attributes\n(toggle / checkbox UI)

  User->>UI: Select attributes to share
  UI->>W: Confirm disclosure selection

  W->>DB: Load full Verifiable Credential
  DB-->>W: VC (full, local-only)

  W->>SD: Apply disclosure rules\n(filter attributes)
  SD-->>W: Minimized attribute set

  W->>CRYPTO: Generate selective proof\n(ZKP / derived credential)
  CRYPTO->>HSM: Sign proof (hardware-backed)
  Note over HSM: Private key never leaves secure hardware
  HSM-->>CRYPTO: Proof signature

  CRYPTO-->>W: Verifiable Presentation\n(selected attributes only)
  W-->>Verifier: VP (cryptographically enforced)
