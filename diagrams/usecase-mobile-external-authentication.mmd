---
title: Use Case - Authentication with External Services
config:
  theme: base
---
flowchart TB
    %% Actors
    User((User))
    ExtService((External Service<br/>Google, Bank, Gov))
    
    %% System Boundary
    subgraph MobileApp["QuantumZero Mobile Application"]
        direction TB
        
        %% Use Cases
        InitAuth[Initiate Authentication with External Service]
        PresentVC[Present Verifiable Credential]
        GenerateZKP[Generate Zero-Knowledge Proof]
        SignWithDID[Sign Authentication Request with DID]
        ReceiveToken[Receive Authentication Token]
        VerifyBiometric[Verify Biometric Before Signing]
        
        %% Relationships between use cases
        InitAuth -.includes.-> PresentVC
        PresentVC -.includes.-> GenerateZKP
        PresentVC -.includes.-> SignWithDID
        SignWithDID -.requires.-> VerifyBiometric
        InitAuth -.includes.-> ReceiveToken
    end
    
    %% Backend Services Boundary
    subgraph BackendServices["Backend Services"]
        direction TB
        
        VerifyProof[Verify Proof]
        ValidateCredStatus[Validate Credential Status]
        
        %% Relationships
        VerifyProof -.includes.-> ValidateCredStatus
    end
    
    %% External Components
    BiometricSystem[Biometric System<br/>iOS FaceID/TouchID<br/>Android BiometricPrompt]
    CryptoEngine[Cryptographic Engine<br/>Secure Enclave/Keystore]
    
    %% Actor-Use Case Relationships
    User -->|initiates| InitAuth
    User -->|performs| VerifyBiometric
    User -->|receives| ReceiveToken
    
    ExtService -->|requests| VerifyProof
    ExtService -->|returns token to| User
    
    %% External Component Relationships
    VerifyBiometric -->|uses| BiometricSystem
    SignWithDID -->|uses| CryptoEngine
    VerifyProof -->|validates| PresentVC
    
    %% Notes
    note1[Priority: A<br/>Security Requirements: F-SEC-01, F-SEC-03, F-SEC-04<br/>External authentication requires biometric<br/>verification and zero-knowledge proofs]
    note2[Preconditions:<br/>- User has QuantumZero wallet<br/>- User has valid credentials<br/>- External service supports VC/VP<br/>- User enrolled biometrics or PIN]
    note3[Postconditions:<br/>- User authenticated with external service<br/>- Authentication token received<br/>- Session established<br/>- Interaction logged]
    note4[Triggers:<br/>- User clicks 'Login with QuantumZero'<br/>- External service requests authentication<br/>- Deep link activated<br/>- OAuth redirect initiated]
    note5[Zero-Knowledge Proof Details:<br/>- Selective disclosure of attributes<br/>- No correlation between presentations<br/>- Privacy-preserving verification<br/>- Cryptographic proof generation]
    note6[Verification Process:<br/>- Credential signature validation<br/>- Issuer DID resolution<br/>- Revocation status check<br/>- Proof verification]
    
    %% Styling
    classDef actor fill:#fff3e0,stroke:#e65100,stroke-width:3px
    classDef useCase fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef backendUseCase fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    classDef component fill:#e0f2f1,stroke:#004d40,stroke-width:2px
    classDef note fill:#fff9c4,stroke:#f57f17,stroke-width:1px,stroke-dasharray: 5 5
    
    class User,ExtService actor
    class InitAuth,PresentVC,GenerateZKP,SignWithDID,ReceiveToken,VerifyBiometric useCase
    class VerifyProof,ValidateCredStatus backendUseCase
    class BiometricSystem,CryptoEngine component
    class note1,note2,note3,note4,note5,note6 note
