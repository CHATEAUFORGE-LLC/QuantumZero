---
title: DFD Level 2 - Manage Trust Policies Process (3.0 Decomposition)
config:
  theme: base
---
%% QuantumZero DFD palette: actors/external=#fff7e6/#b45309, process=#e0f2fe/#075985, datastore=#ecfccb/#4d7c0f
%% Level 2: Detailed decomposition of Process 3.0 (Manage Trust Policies) from Level 1
flowchart TB
    %% QuantumZero DFD palette (standardized)
    classDef actor fill:#fff7e6,stroke:#b45309,stroke-width:2px
    classDef process fill:#e0f2fe,stroke:#075985,stroke-width:2px
    classDef datastore fill:#ecfccb,stroke:#4d7c0f,stroke-width:2px

    %% External Entities
    Admin["Admin User"]:::actor

    %% Level 2 Sub-processes (3.x numbering)
    P31(("3.1<br/>Validate<br/>Policy<br/>Definition")):::process
    P32(("3.2<br/>Create<br/>Policy<br/>Record")):::process
    P33(("3.3<br/>Define<br/>Policy<br/>Rules")):::process
    P34(("3.4<br/>Set Policy<br/>Scope")):::process
    P35(("3.5<br/>Activate/<br/>Deactivate<br/>Policy")):::process
    P36(("3.6<br/>Query<br/>Policies")):::process
    P37(("3.7<br/>Generate<br/>Audit<br/>Event")):::process

    %% Data Stores
    D6[("D6: trust_policy (trusted registry DB)")]:::datastore
    D7[("D7: trust_policy_rule (trusted registry DB)")]:::datastore
    D8[("D8: trust_policy_scope (trusted registry DB)")]:::datastore
    D11[("D11: audit_logs (admin DB)")]:::datastore
    D12[("D12: users/sessions (admin DB)")]:::datastore

    %% Input from Admin
    Admin -->|"POST /policies<br/>(policy definition)"| P31
    Admin -->|"PUT /policies/{id}<br/>(updates)"| P35
    Admin -->|"GET /policies<br/>(query params)"| P36

    %% Sub-process 3.1: Validate policy definition
    P31 -.->|"verify admin role"| D12
    D6 -.->|"check conflicts"| P31
    P31 -->|"validated policy"| P32
    P31 -->|"validation errors"| Admin

    %% Sub-process 3.2: Create policy record
    P32 -->|"policy record<br/>(name, version,<br/>status=draft)"| D6
    P32 -->|"policy_id"| P33

    %% Sub-process 3.3: Define policy rules
    P33 -->|"rule records<br/>(condition, action,<br/>priority)"| D7
    D7 -.->|"existing rules"| P33
    P33 -->|"policy_id"| P34

    %% Sub-process 3.4: Set policy scope
    P34 -->|"scope records<br/>(issuer_id,<br/>credential_type,<br/>context)"| D8
    P34 -->|"policy_id"| P37
    P34 -->|"policy confirmation"| Admin

    %% Sub-process 3.5: Activate/deactivate policy
    P35 -.->|"verify permissions"| D12
    D6 -.->|"current policy"| P35
    P35 -->|"updated status<br/>(active/inactive/<br/>deprecated)"| D6
    P35 -->|"policy_id"| P37
    P35 -->|"status confirmation"| Admin

    %% Sub-process 3.6: Query policies
    P36 -.->|"read policies"| D6
    P36 -.->|"read rules"| D7
    P36 -.->|"read scopes"| D8
    P36 -->|"policy list/<br/>details"| Admin

    %% Sub-process 3.7: Generate audit event
    P37 -->|"audit record<br/>(action, admin_id,<br/>policy_id, timestamp)"| D11
