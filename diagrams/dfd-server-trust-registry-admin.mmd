---
title: DFD - Trusted Registry Administration (LedgerDB) (Level 1) (Planned)
config:
  theme: base
---
%% QuantumZero UML palette note: actors/external=#fff7e6/#b45309, system/component=#e0f2fe/#075985, datastore=#ecfccb/#4d7c0f, notes=#fff9c4/#d97706. Aligns diagrams to Deliverable 1 UML/DFD theme.
%% Source of truth for data stores: QuantumZero-server/ledgerDB/init.sql (service layer not implemented in Rust workspace)
flowchart LR
    %% QuantumZero UML/DFD palette (standardized)
    classDef actor fill:#fff7e6,stroke:#b45309,stroke-width:2px
    classDef process fill:#e0f2fe,stroke:#075985,stroke-width:2px
    classDef datastore fill:#ecfccb,stroke:#4d7c0f,stroke-width:2px
    classDef external fill:#eef2ff,stroke:#4338ca,stroke-width:2px

    %% External Entities
    Admin([Admin User Browser]):::actor

    %% Processes (Yourdon circles)
    P1(("1.0 Manage Issuer Directory")):::process
    P2(("2.0 Manage Credential Templates")):::process
    P3(("3.0 Manage Trust Policies")):::process
    P4(("4.0 Build Offline Cache Package")):::process
    P5(("5.0 Write Audit Event")):::process

    %% Data Stores (LedgerDB / Trusted Registry DB)
    D1[["D1 issuer"]]:::datastore
    D2[["D2 issuer_did"]]:::datastore
    D3[["D3 issuer_endpoint"]]:::datastore
    D4[["D4 credential_template"]]:::datastore
    D5[["D5 template_field"]]:::datastore
    D6[["D6 trust_policy"]]:::datastore
    D7[["D7 trust_policy_rule"]]:::datastore
    D8[["D8 trust_policy_scope"]]:::datastore
    D9[["D9 offline_cache_package"]]:::datastore
    D10[["D10 offline_cache_item"]]:::datastore
    D11[["D11 audit_event"]]:::datastore
    D12[["D12 admin_user/admin_role"]]:::datastore

    %% Flows
    Admin -- issuer onboarding/updates --> P1
    P1 --> D1
    P1 --> D2
    P1 --> D3
    P1 --> P5
    P1 --> Admin

    Admin -- template CRUD --> P2
    P2 --> D4
    P2 --> D5
    P2 --> P5
    P2 --> Admin

    Admin -- policy CRUD/activate --> P3
    P3 --> D6
    P3 --> D7
    P3 --> D8
    P3 --> P5
    P3 --> Admin

    Admin -- export/offline build --> P4
    P4 --> D9
    P4 --> D10
    P4 --> P5
    P4 --> Admin

    %% AuthN/AuthZ is data-backed (roles/users)
    P1 -.- D12
    P2 -.- D12
    P3 -.- D12
    P4 -.- D12

    %% Audit sink
    P5 --> D11

