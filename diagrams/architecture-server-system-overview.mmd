---
title: Architecture - Server System Overview
config:
  theme: base
---
%% System architecture view connecting mobile wallet, server services, and ledger integration.
%% Related: diagrams/component-system-complete.mmd (system components), diagrams/component-server-overview.mmd (server boundaries)
flowchart TB
    %% UML palette (standardized)
    classDef actor fill:#fff7e6,stroke:#b45309,stroke-width:2px
    classDef system fill:#eef2ff,stroke:#4338ca,stroke-width:2px
    classDef component fill:#e0f2fe,stroke:#075985,stroke-width:2px
    classDef service fill:#e8f5e9,stroke:#166534,stroke-width:2px
    classDef datastore fill:#ecfccb,stroke:#4d7c0f,stroke-width:2px
    classDef externalSystem fill:#fee2e2,stroke:#b91c1c,stroke-width:2px
    classDef security fill:#fee2e2,stroke:#b91c1c,stroke-width:2px,stroke-dasharray: 5 3

    %% Mobile boundary
    subgraph Mobile["<<system>> QuantumZero Mobile Wallet (Flutter)"]
        direction TB
        UI["<<component>> UI Screens<br>HomeScreen / QrScanScreen / QrPresentationScreen"]:::component
        Core["<<component>> Wallet Core<br>Providers / Repositories / Services"]:::component
        LocalDB[("Local SQLite (sqflite)<br>wallet storage")]:::datastore
        SE["Secure Enclave / Android Keystore"]:::security
    end

    %% Server boundary
    subgraph Server["<<system>> QuantumZero Server (Docker)"]
        direction TB
        WebFrontend["<<component>> Web Frontend :3000<br>Static HTML/CSS/JS"]:::component
        AdminAPI["<<component>> Admin API :8080<br>Actix-Web<br>SQLx"]:::service
        AdminDB[("PostgreSQL 16 :5432<br>Admin DB (users/sessions/audit/metrics)")]:::datastore

        Gateway["<<component>> API Gateway<br>TLS termination (TLS 1.3)"]:::component
        IssuanceAPI["<<component>> Issuance API"]:::service
        VerificationAPI["<<component>> Verification API"]:::service
        RevocationAPI["<<component>> Revocation API"]:::service
        TrustReg[("PostgreSQL 16 :5433<br>Trusted Registry DB (staging<br>registry<br>policy)")]:::datastore
    end

    %% Ledger boundary
    subgraph Ledger["<<system>> Indy Ledger (Docker network: indy)"]
        direction TB
        LedgerBrowser["<<component>> Ledger Browser :8000<br>(host :9000)"]:::externalSystem
        IndyPool["<<component>> Indy Pool<br>node1..node4"]:::externalSystem
    end

    %% Actors
    Holder(("Holder / Wallet User")):::actor
    Verifier(("Verifier / Relying Party")):::actor
    Admin(("Admin User (Browser)")):::actor
    Issuer(("Issuer System / Operator")):::actor

    %% Mobile flows
    Holder --> UI
    Verifier -- "QR request/presentation" --> UI
    UI --> Core
    Core --> SE
    Core --> LocalDB

    %% Server flows
    Admin --> WebFrontend
    Admin --> AdminAPI
    AdminAPI --> AdminDB
    AdminAPI --> TrustReg
    AdminAPI -->|"HTTP ledger queries"| LedgerBrowser
    LedgerBrowser --> IndyPool

    %% Gateway routing and additional APIs
    Admin -->|HTTPS| Gateway
    Issuer -->|HTTPS| Gateway
    Verifier -->|HTTPS| Gateway
    Gateway --> AdminAPI
    Gateway --> IssuanceAPI
    Gateway --> VerificationAPI
    Gateway --> RevocationAPI

    IssuanceAPI -. ledger access .-> LedgerBrowser
    VerificationAPI -. ledger access .-> LedgerBrowser
    RevocationAPI -. ledger access .-> LedgerBrowser
    IssuanceAPI -. trust registry .-> TrustReg
    VerificationAPI -. trust registry .-> TrustReg
    RevocationAPI -. trust registry .-> TrustReg
