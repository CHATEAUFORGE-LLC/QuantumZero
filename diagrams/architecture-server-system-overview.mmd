---
title: Architecture - Server System Overview (Current + Planned APIs)
config:
  theme: base
---
%% QuantumZero UML palette note: actors/external=#fff7e6/#b45309, system/component=#e0f2fe/#075985, datastore=#ecfccb/#4d7c0f, notes=#fff9c4/#d97706. Aligns diagrams to Deliverable 1 UML/DFD theme.
flowchart TB
    %% QuantumZero UML palette (standardized)
    classDef actor fill:#fff7e6,stroke:#b45309,stroke-width:2px
    classDef system fill:#eef2ff,stroke:#4338ca,stroke-width:2px
    classDef component fill:#e0f2fe,stroke:#075985,stroke-width:2px
    classDef service fill:#e8f5e9,stroke:#166534,stroke-width:2px
    classDef datastore fill:#ecfccb,stroke:#4d7c0f,stroke-width:2px
    classDef external fill:#fee2e2,stroke:#b91c1c,stroke-width:2px
    classDef security fill:#fee2e2,stroke:#b91c1c,stroke-width:2px,stroke-dasharray: 5 3
    classDef planned fill:#f3f4f6,stroke:#6b7280,stroke-width:2px,stroke-dasharray: 5 3

    %% Mobile boundary (QuantumZero-mobile baseline)
    subgraph Mobile["<<system>> QuantumZero Mobile Wallet (Flutter)"]
        direction TB
        UI["<<component>> UI Screens<br/>HomeScreen / QrScanScreen / QrPresentationScreen"]:::component
        subgraph LocalSecurity["<<component>> Hardware Security"]
            SE["Secure Enclave / Android Keystore"]:::security
        end
        subgraph MobileLogic["<<component>> Wallet Logic"]
            Providers["Riverpod StateNotifiers<br/>DidNotifier / CredentialNotifier / QrGenerationNotifier"]:::component
            Repos["Repositories<br/>DidRepository / CredentialRepository"]:::component
            Services["Services<br/>CryptoService / SecureStorageService / BiometricService<br/>QrScanningService / QrGenerationService<br/>SelectiveDisclosureService"]:::component
            LocalDB[("Local SQLite (planned)<br/>credential cache")]:::datastore
        end
    end

    %% Server boundary (QuantumZero-server baseline)
    subgraph Server["<<system>> QuantumZero Server (Docker)"]
        direction TB
        WebFrontend["<<component>> Web Frontend :3000<br/>Static HTML/CSS/JS"]:::component
        AdminAPI["<<component>> Admin API :8080<br/>Actix-Web + SQLx"]:::service
        Postgres[("PostgreSQL 16 :5432<br/>issuers/schemas/cred_defs/users/sessions")]:::datastore

        %% Planned target design: 4 API services behind a gateway
        Gateway["<<component>> API Gateway (Planned)<br/>TLS termination (TLS 1.3 requirement)"]:::planned
        IssuanceAPI["<<component>> Issuance API (Planned)"]:::planned
        VerificationAPI["<<component>> Verification API (Planned)"]:::planned
        RevocationAPI["<<component>> Revocation API (Planned)"]:::planned
        TrustReg[("Trust Registry DB (LedgerDB) (Planned)<br/>schema reference: QuantumZero-server/ledgerDB")]:::planned
    end

    %% Ledger boundary (external Docker network)
    subgraph Ledger["<<system>> Indy Ledger (Docker network: indy)"]
        direction TB
        LedgerBrowser["<<component>> Ledger Browser :8000<br/>(host :9000)"]:::component
        IndyPool["<<component>> Indy Pool<br/>node1..node4"]:::component
    end

    %% Actors
    Holder(("Holder / Wallet User")):::actor
    Verifier(("Verifier / Relying Party")):::actor
    Admin(("Admin User (Browser)")):::actor
    Issuer(("Issuer System / Operator")):::actor

    %% Flows
    Holder --> UI
    Verifier -- QR request/presentation --> UI
    UI --> Providers
    Providers --> Repos
    Repos --> Services
    Services --> SE
    Repos --> LocalDB

    Admin --> WebFrontend
    Admin --> AdminAPI
    AdminAPI --> Postgres
    AdminAPI -->|HTTP ledger queries| LedgerBrowser
    LedgerBrowser --> IndyPool

    %% Planned gateway routing and additional APIs
    Admin -. HTTPS planned .-> Gateway
    Issuer -. HTTPS planned .-> Gateway
    Verifier -. HTTPS planned .-> Gateway
    Gateway -.-> AdminAPI
    Gateway -.-> IssuanceAPI
    Gateway -.-> VerificationAPI
    Gateway -.-> RevocationAPI

    IssuanceAPI -. ledger access planned .-> LedgerBrowser
    VerificationAPI -. ledger access planned .-> LedgerBrowser
    RevocationAPI -. ledger access planned .-> LedgerBrowser
    IssuanceAPI -. trust registry planned .-> TrustReg
    VerificationAPI -. trust registry planned .-> TrustReg
    RevocationAPI -. trust registry planned .-> TrustReg
