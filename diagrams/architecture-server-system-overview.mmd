---
title: Architecture - Server System Overview
config:
  theme: base
---
%% QuantumZero UML palette note: actors/external=#fff7e6/#b45309, system/component=#e0f2fe/#075985, datastore=#ecfccb/#4d7c0f, notes=#fff9c4/#d97706. Aligns diagrams to Deliverable 1 UML/DFD theme.
%% Related: diagrams/component-system-complete.mmd (system components), diagrams/component-mobile-layers.mmd (mobile internals), diagrams/component-server-overview.mmd (server service boundaries), diagrams/deployment-server-infrastructure.mmd (deployment)
flowchart TB
    %% QuantumZero UML palette (standardized)
    classDef actor fill:#fff7e6,stroke:#b45309,stroke-width:2px
    classDef system fill:#eef2ff,stroke:#4338ca,stroke-width:2px
    classDef component fill:#e0f2fe,stroke:#075985,stroke-width:2px
    classDef service fill:#e8f5e9,stroke:#166534,stroke-width:2px
    classDef datastore fill:#ecfccb,stroke:#4d7c0f,stroke-width:2px
    classDef external fill:#fee2e2,stroke:#b91c1c,stroke-width:2px
    classDef security fill:#fee2e2,stroke:#b91c1c,stroke-width:2px,stroke-dasharray: 5 3

    %% Mobile boundary (QuantumZero-mobile baseline)
    subgraph Mobile["<<system>> QuantumZero Mobile Wallet (Flutter)"]
        direction TB
        UI["<<component>> UI Screens<br/>HomeScreen / QrScanScreen / QrPresentationScreen"]:::component
        Core["<<component>> Wallet Core<br/>Providers / Repositories / Services"]:::component
        LocalDB[("Local SQLite (sqflite)<br/>wallet storage")]:::datastore
        SE["Secure Enclave / Android Keystore"]:::security
    end

    %% Server boundary (QuantumZero-server baseline)
    subgraph Server["<<system>> QuantumZero Server (Docker)"]
        direction TB
        WebFrontend["<<component>> Web Frontend :3000<br/>Static HTML/CSS/JS"]:::component
        AdminAPI["<<component>> Admin API :8080<br/>Actix-Web + SQLx"]:::service
        AdminDB[("PostgreSQL 16 :5432<br/>Admin DB (users/sessions/audit/metrics)")]:::datastore

        %% Target design: 4 API services behind a gateway
        Gateway["<<component>> API Gateway<br/>TLS termination (TLS 1.3)"]:::component
        IssuanceAPI["<<component>> Issuance API"]:::service
        VerificationAPI["<<component>> Verification API"]:::service
        RevocationAPI["<<component>> Revocation API"]:::service
        TrustReg[("PostgreSQL 16 :5433<br/>Trusted Registry DB (staging + registry + policy)")]:::datastore
    end

    %% Ledger boundary (external Docker network)
    subgraph Ledger["<<system>> Indy Ledger (Docker network: indy)"]
        direction TB
        LedgerBrowser["<<component>> Ledger Browser :8000<br/>(host :9000)"]:::component
        IndyPool["<<component>> Indy Pool<br/>node1..node4"]:::component
    end

    %% Actors
    Holder(("Holder / Wallet User")):::actor
    Verifier(("Verifier / Relying Party")):::actor
    Admin(("Admin User (Browser)")):::actor
    Issuer(("Issuer System / Operator")):::actor

    %% Flows
    Holder --> UI
    Verifier -- QR request/presentation --> UI
    UI --> Core
    Core --> SE
    Core --> LocalDB

    Admin --> WebFrontend
    Admin --> AdminAPI
    AdminAPI --> AdminDB
    AdminAPI --> TrustReg
    AdminAPI -->|HTTP ledger queries| LedgerBrowser
    LedgerBrowser --> IndyPool

    %% Gateway routing and additional APIs
    Admin -->|HTTPS| Gateway
    Issuer -->|HTTPS| Gateway
    Verifier -->|HTTPS| Gateway
    Gateway --> AdminAPI
    Gateway --> IssuanceAPI
    Gateway --> VerificationAPI
    Gateway --> RevocationAPI

    IssuanceAPI -. ledger access .-> LedgerBrowser
    VerificationAPI -. ledger access .-> LedgerBrowser
    RevocationAPI -. ledger access .-> LedgerBrowser
    IssuanceAPI -. trust registry .-> TrustReg
    VerificationAPI -. trust registry .-> TrustReg
    RevocationAPI -. trust registry .-> TrustReg
