---
title: DFD Level 1 - Staged Registry Approval (Process Decomposition)
config:
  theme: base
---
%% QuantumZero DFD palette: actors/external=#fff7e6/#b45309, process=#e0f2fe/#075985, datastore=#ecfccb/#4d7c0f
%% Level 1: Decomposes staged approval into major processes with data stores
flowchart TB
    %% QuantumZero DFD palette (standardized)
    classDef actor fill:#fff7e6,stroke:#b45309,stroke-width:2px
    classDef process fill:#e0f2fe,stroke:#075985,stroke-width:2px
    classDef datastore fill:#ecfccb,stroke:#4d7c0f,stroke-width:2px

    %% External Entities
    Admin["Admin User"]:::actor
    Issuer["Issuer System"]:::actor

    %% Level 1 Processes
    P1(("1.0<br/>Capture<br/>Issuer Requests")):::process
    P2(("2.0<br/>Approve<br/>Issuer Requests")):::process
    P3(("3.0<br/>Approve<br/>Schema Requests")):::process
    P4(("4.0<br/>Approve<br/>Cred Def Requests")):::process
    P5(("5.0<br/>Audit<br/>Logging")):::process

    %% Data Stores
    D1[("D1: issuer_requests (staging)")]:::datastore
    D2[("D2: schema_requests (staging)")]:::datastore
    D3[("D3: cred_def_requests (staging)")]:::datastore
    D4[("D4: issuers (trusted registry DB)")]:::datastore
    D5[("D5: schemas (trusted registry DB)")]:::datastore
    D6[("D6: credential_definitions (trusted registry DB)")]:::datastore
    D7[("D7: audit_logs (admin DB)")]:::datastore

    %% Issuer submissions
    Issuer -->|"issuer onboarding"| P1
    Issuer -->|"schema requests"| P3
    Issuer -->|"cred def requests"| P4

    %% Admin approvals
    Admin -->|"approve/reject issuers"| P2
    Admin -->|"approve/reject schemas"| P3
    Admin -->|"approve/reject cred defs"| P4

    %% Staging writes
    P1 -->|"store request"| D1
    P3 -->|"store request"| D2
    P4 -->|"store request"| D3

    %% Review flows
    D1 -.->|"pending requests"| P2
    D2 -.->|"pending requests"| P3
    D3 -.->|"pending requests"| P4

    %% Approvals update trusted registry + staging
    P2 -->|"approved issuer"| D4
    P2 -->|"update status"| D1
    P3 -->|"approved schema"| D5
    P3 -->|"update status"| D2
    P4 -->|"approved cred def"| D6
    P4 -->|"update status"| D3

    %% Audit flows
    P2 -->|"audit event"| P5
    P3 -->|"audit event"| P5
    P4 -->|"audit event"| P5
    P5 -->|"audit record"| D7

    %% Responses
    P2 -->|"approval status"| Admin
    P3 -->|"approval status"| Admin
    P4 -->|"approval status"| Admin
