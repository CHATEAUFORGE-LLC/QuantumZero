---
title: DFD Level 2 - Mobile Credential Presentation Process
config:
  theme: base
---
%% DFD Level 2: Detailed credential presentation/verification flow with selective disclosure.
flowchart TB
    %% DFD styling
    classDef external fill:#fff2cc,stroke:#111111,stroke-width:1.5px
    classDef process fill:#fff2cc,stroke:#111111,stroke-width:1.5px
    classDef datastore fill:#fff2cc,stroke:#111111,stroke-width:1.5px

    %% External Entities
    Holder["Mobile User<br>(Credential Holder)"]:::external
    Verifier["Verifier Service<br>(QR/API)"]:::external

    %% Processes
    P4_1(["4.1<br>Scan Request<br>QR Code"]):::process
    P4_2(["4.2<br>Parse Presentation<br>Request"]):::process
    P4_3(["4.3<br>Match<br>Credentials"]):::process
    P4_4(["4.4<br>Select Attributes<br>to Disclose"]):::process
    P4_5(["4.5<br>Generate<br>Proof"]):::process
    P4_6(["4.6<br>Create<br>Presentation"]):::process
    P4_7(["4.7<br>Send<br>Presentation"]):::process
    P4_8(["4.8<br>Receive<br>Result"]):::process

    %% Data Stores
    D1[("D1: dids<br>(local SQLite)")]:::datastore
    D2[("D2: credentials<br>(local SQLite)")]:::datastore
    D3[("D3: keys<br>(secure storage)")]:::datastore

    %% Presentation Flow
    Holder -->|"scan QR"| P4_1
    Verifier -->|"presentation request<br>(QR encoded)"| P4_1
    P4_1 -->|"raw QR data"| P4_2

    P4_2 -->|"parsed request<br>required attributes<br>verifier info"| P4_3

    D2 -.->|"credential records"| P4_3
    P4_3 -->|"matching credentials"| P4_4
    P4_3 -->|"no match found"| Holder

    P4_4 -->|"credential options<br>requested attributes"| Holder
    Holder -->|"selected credential<br>attribute choices"| P4_4
    Holder -->|"cancel presentation"| P4_4
    P4_4 -->|"cancelled"| Holder

    P4_4 -->|"disclosure selection"| P4_5
    D1 -.->|"holder DID"| P4_5
    D3 -.->|"signing key"| P4_5
    D2 -.->|"credential data"| P4_5

    P4_5 -->|"cryptographic proof<br>selective disclosure"| P4_6
    P4_6 -->|"signed presentation"| P4_7

    P4_7 -->|"presentation<br>proofs<br>disclosed attributes"| Verifier
    Verifier -->|"verification result"| P4_8

    P4_8 -->|"success/failure<br>status message"| Holder
